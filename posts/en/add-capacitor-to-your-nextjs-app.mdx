---
title: "The Perfect Guide to Transforming a NextJS App into a Native App"
summary: This article will introduce how I transformed a pure Web App into an elegant Native App, enabling the product to run on multiple platforms.
keywords:
  - Open Source
tag: Coding
createAt: 2024-05-02T00:00:00.000Z
---

[Geekits](https://geekits.ygeeker.com/) is an open-source project I have been developing for over five years and is the one I have maintained the longest. After continuous iterations, the Next technology stack has stabilized.

This article will introduce how I transformed a pure Web App into an elegant Native App, enabling the product to run on multiple platforms.

The transformation involves more than just placing the App in a WebView; it requires removing unnecessary features for the native app, replacing certain JS implementations with native APIs, adapting styles, and more.

## Why Create a Native App

I personally do **not fully** agree with the statement that "the web is the future." However, I really like local-first web apps, so even when developing the Web App, I made every effort to make Geekits available offline.

Migrating to native makes the implementation of local-first more convenient, resources load faster, and large data does not need to be loaded online (for example, the idiom query feature).

Moreover, **the operable window size is larger**, eliminating the worry of accidentally closing tabs, and the response speed is faster.

Finally, the system provides more information that is inconvenient for browsers to access (or version-restricted), such as accelerometer data, battery information, etc.

## Step 1 - Install and Configure Capacitor

Thanks to Capacitor's excellent developer experience (DX), if all goes well, you can get a "working" native version in just a few minutes.

First, install Capacitor:

```bash
npm i @capacitor/core
npm i -D @capacitor/cli
npx cap init
npm i @capacitor/android @capacitor/ios
```

Modify the configuration file `capacitor.config.js`:

```javascript
import { CapacitorConfig } from "@capacitor/cli";

const config: CapacitorConfig = {
	appId: "com.ygeeker.geekits",
	appName: "Geekits",
	webDir: "out",
	server: {
		androidScheme: "https",
		errorPath: "/500.html",
	},
};

export default config;
```

If your Next APP has always been a pure static export, congratulations, you are done. Run this command to compile your Next App into static files:

```bash
next export
```

Then sync the compiled code to Capacitor:

```bash
npx cap sync
```

Done!

However, if your Next App uses a hybrid build mode (for example, utilizing server-side features), you may not be able to execute `next export` directly. You need to move some server-dependent logic to the client side. For example:

- The client uses the device API to get the locale (instead of Next's Locale API)
- The client uses hooks to fetch data (instead of using methods like `getServerProps`)

Here is an example of getting the Locale from the client:

```javascript
async function getDeviceLanguage() {
	let { value } = await Device.getLanguageCode();

	if (value === "en") {
		value = "en-US";
	}
	if (value === "zh") {
		value = "zh";
	}

	return value;
}

function MainApp({ Component, pageProps }: AppProps) {
	// The auto-detected locale from NextJS
	// If the user has no preferred locale, use auto
	const [preferredLocale, setPreferredLocale] = useState(pageProps.locale);

	useEffect(() => {
		const readLocaleConfig = async () => {
			// https://en.wikipedia.org/wiki/IETF_language_tag
			let preferredSet = localStorage.getItem("locale");
			if (preferredSet) {
				if (preferredSet === "auto" && !isWeb()) {
					setPreferredLocale(await getDeviceLanguage());
				} else if (preferredSet !== "auto") {
					// If the user has specified the language
					setPreferredLocale(preferredSet);
				}
			}
		};

		readLocaleConfig();
	}, []);
	
}
```

## Step 2 - Add Safe Area Insets

At this point, we have a basic native App, but there are still many small issues that need to be adapted.

Unlike the browser environment, the irregular screens of mobile devices can affect display, such as notches and holes. To avoid bleeding, you can add the following global variables in the global CSS file:

```css
html {
	--ion-safe-area-top: env(safe-area-inset-top);
	--ion-safe-area-bottom: env(safe-area-inset-bottom);
	--ion-safe-area-left: env(safe-area-inset-left);
	--ion-safe-area-right: env(safe-area-inset-right);
}
```

Then use this property in places where you need to reserve the Bleeding Area, such as the Appbar (header):

```css
padding-top: var(--ion-safe-area-top),
```

## Step 3 - Runtime Condition Handling

Although Capacitor provides APIs to detect the running platform, during the static export process of Next, its API will always detect as a browser environment.

For example, sometimes we want certain React components to appear only on the native platform, and during export, we need to inform Next whether we are packaging for the native platform.

To detect the specified packaging platform during the Next export process, we can manually add an environment variable to specify the export target. For convenience, you can write the following scripts in `package.json`:

```json
"scripts": {
		"build": "next build",
		"build:cap": "CAPACITOR_BUILD=true next build && CAPACITOR_BUILD=true next export && npx cap sync",
		"dev:cap": "CAPACITOR_BUILD=true next",
 },
```

Next, encapsulate a method to detect the packaging platform:

```javascript
const isCapacitor = () => process.env.CAPACITOR_BUILD === "true";
```

## Step 4 - Add Native Icons

Capacitor does not generate various sizes of native App icons for you; you need to create and replace them manually.

You only need to prepare a 1024 x 1024 icon image, and then you can use [this tool](https://www.appicon.co/) to generate icons for iOS and Android platforms with one click.

Simply replace the downloaded files in your project.

P.S. This tool cannot generate [Adaptive Icons](https://developer.android.com/develop/ui/views/launch/icon_design_adaptive), so you will need to create the foreground and background yourself.

## Next Steps

The capabilities of Capacitor go far beyond what is written in this article; you can explore more possibilities from the [official documentation](https://capacitorjs.com/docs/).

